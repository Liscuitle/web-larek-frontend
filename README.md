# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и их типы, которые используются в приложении:

Тип продукта:
```
export interface IProductItem {
  id: string;
  title: string;
  category: string;
  description: string;
  image: string;
  price: number | null;
}
```

Состояние приложения:
```

export interface IAppState {
  catalog: IProductItem[];
  preview: string; // ID выбранного для предпросмотра продукта
  basket: string[]; // список ID продуктов в корзине
  order: IOrder;    // данные текущего заказа
  total: number;    // итог, вычисляемый из позиций в корзине
  loading: boolean; // признак того, что данные сейчас загружаются
}
```

Данные формы заказа:
```

export interface IOrderForm {
  payment?: string;
  address?: string;
  phone?: string;
  email?: string;
  total?: number;
}
```

Данные заказа:
```

export interface IOrder extends IOrderForm {
  items: string[]; // ID продуктов
}
```

Результат заказа:
```

export interface IOrderResult {
  id: string;
}
```

Ошибки формы:
```

export type FormErrors = Partial<Record<keyof IOrder, string>>;
```


## Архитектура приложения
В проекте код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

Также используется событийно-ориентированный подход.

## Базовый код

## Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:

- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

## Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом IEvents:

- on - подписка на событие
- emit - инициализация события
- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

## Абстрактный класс Component<T>
Базовый класс для всех компонентов пользовательского интерфейса.
Методы:

```constructor(protected container: HTMLElement)```
Инициализирует компонент с указанным контейнером HTMLElement.

```toggleClass(element: HTMLElement, className: string, force?: boolean): void```
Переключает класс className на элементе element.
Параметр force позволяет явно установить или снять класс:
true — добавить класс.
false — удалить класс.
undefined — переключить класс (если есть — удалить, если нет — добавить).

```setDisabled(element: HTMLElement, state: boolean): void```
Устанавливает или снимает атрибут disabled у элемента element в зависимости от значения state:
true — добавляет атрибут disabled.
false — удаляет атрибут disabled.

```protected setText(element: HTMLElement, value: unknown): void```
Устанавливает текстовое содержимое элемента element значением value, преобразованным в строку.

```protected setImage(element: HTMLImageElement, src: string, alt?: string): void```
Устанавливает изображение для элемента img:
src — путь к изображению.
alt — альтернативный текст (опционально).

```render(data?: Partial<T>): HTMLElement```
Рендерит компонент, обновляя его свойства данными из data, если они предоставлены.
Возвращает контейнер компонента HTMLElement.

## Абстрактный класс Model
Базовый класс для моделей данных.
```constructor(data: Partial<T>, protected events: IEvents)```

```data``` — Начальные данные модели.

```events``` — Экземпляр EventEmitter для генерации событий при изменении данных.
Методы:

```emitChanges(event: string, payload?: object): void ``` — Генерирует событие об изменении данных.

## Компоненты модели данных

## Класс LarekApi
Этот класс расширяет базовый класс Api и добавляет специфические методы для взаимодействия с API

Список методов класса LarekApi:

```constructor(cdnUrl: string, baseUrl: string, options?: RequestInit)```

Инициализирует экземпляр класса, устанавливая URL CDN и базовый URL API.
```fetchProductList(): Promise<IProductItem[]>```

Получает список продуктов с сервера.

```submitOrder(orderData: IOrder): Promise<IOrderResult>```

Отправляет заказ на сервер.

## AppData (Модель данных приложения)

Описание:

Хранит состояние приложения, управляет каталогом, корзиной и заказами.

Методы:
setCatalog(items: IProductItem[]): void
Загружает список продуктов в модель.

Параметры:

items: IProductItem[] — Массив продуктов.

addToOrder(product: Product): void

Добавляет продукт в список товаров заказа.
Параметры:

product: Product — Продукт для добавления.
clearBasket(): void
Очищает корзину и список товаров заказа.

validateOrder(): boolean
Проверяет валидность данных заказа.
Возвращает:

boolean — true, если все данные валидны, иначе false.
getTotal(): number
Рассчитывает общую стоимость товаров в корзине.
Возвращает:

number — Общая сумма.

## Класс Product

Основная функциональность класса Product

Класс описывает свойства каждого продукта, такие как идентификатор, название, описание, цена и изображение.

Интеграция с EventEmitter Класс принимает в конструкторе экземпляр EventEmitter, который позволяет объектам генерировать события для взаимодействия с другими частями приложения.

Управление данными С помощью конструктора объект Product наполняется данными из интерфейса IProductItem.

Основные свойства
id: string
Уникальный идентификатор продукта, используется для операций с продуктом (например, добавления в корзину).

title: string
Название продукта, отображается в карточке товара.

description: string
Описание продукта, используется в подробном просмотре продукта.

category: string
Категория продукта, которая может быть использована для фильтрации.

image: string
Ссылка на изображение продукта.

price: number | null
Цена продукта. Если значение null, отображается как "Бесценно".


## Компоненты представления

## Класс Card
Отображает карточку товара и обрабатывает действия пользователя.

Конструктор:

```constructor(container: HTMLElement, actions?: ICardActions)```

```container``` — HTML-элемент контейнера карточки.

```actions``` — Обработчики событий (onSelect, onAdd, onRemove).

Методы и свойства:

```title``` — Устанавливает заголовок карточки.

```category``` — Устанавливает категорию товара и соответствующий CSS-класс.

```image``` — Устанавливает изображение товара.

```price``` — Устанавливает цену товара.

## Класс CardPreview
Класс CardPreview наследует все методы и свойства базового класса Card, что позволяет использовать их без необходимости повторного определения. 

```constructor(container: HTMLElement, actions?: ICardActions)```

Параметры:

```container: HTMLElement``` — контейнер карточки товара в DOM.

```actions: ICardActions``` — объект, содержащий обработчики событий для карточки (onSelect, onAdd, onRemove).

Методы

```set text(content: string)```

Описание:

Сеттер для установки текста описания товара.
Использует защищённый метод setText из родительского класса Component для обновления содержимого textElement

```set addButtonEnabled(isEnabled: boolean)```

Описание:

Сеттер для управления доступностью кнопки добавления в корзину.
Принимает булевый параметр isEnabled, который определяет, должна ли кнопка быть активной.
Использует метод setDisabled из родительского класса Component для установки атрибута disabled у кнопки.


```updateButtonState(isInBasket: boolean, isPriceless: boolean): void```

Описание:

Метод для обновления состояния кнопки добавления в корзину в зависимости от текущего состояния товара.

```isInBasket```: указывает, находится ли товар уже в корзине.

```isPriceless```: указывает, имеет ли товар цену.

Логика:
Если товар бесценен (isPriceless), кнопка отображает текст "Бесценно" и отключается.
Если товар уже в корзине (isInBasket), кнопка отображает текст "В корзине" и отключается.
В противном случае, кнопка отображает текст "В корзину" и становится активной.

## Класс CardBasket
Отображает товар в корзине и позволяет его удалить.

Конструктор:

```constructor(container: HTMLElement, actions?: ICardActions)```

Методы и свойства:

```title``` — Устанавливает заголовок товара.
```price``` — Устанавливает цену товара.
```index``` — Устанавливает индекс товара в списке корзины.

## Класс Basket
Отображает содержимое корзины и обрабатывает действия пользователя.

Методы:

```render(basket: IBasket): void```  — Отображает товары в корзине.
```toggleCheckoutButton(isEnabled: boolean): void``` — Включает/отключает кнопку оформления заказа.

События:

Эмитирует ```'basket:removeItem'``` при удалении товара.
Эмитирует ```'basket:checkout'``` при нажатии на кнопку оформления заказа.

## Класс Order
Форма оформления заказа.

Конструктор:

 ```constructor(formElement: HTMLFormElement, eventBus: IEvents) ```

Методы:

 ```render(data?: IOrderFormData): void ``` — Отображает форму заказа.
 ```getData(): IOrderFormData ```  — Возвращает данные формы.
События:

Эмитирует  ```'orderForm:submit' ``` при отправке формы.

## Класс Contacts
Форма ввода контактных данных.

Конструктор:

 ```constructor(formElement: HTMLFormElement, eventBus: IEvents) ```

Методы:

 ```render(data?: IContactFormData): void ``` — Отображает форму контактов.
 ```getData(): IContactFormData ``` — Возвращает данные формы.

События:

Эмитирует 'contactForm:submit' при отправке формы.

## Класс Success
Отображает сообщение об успешном оформлении заказа.

### Методы:


- **constructor(container: HTMLElement, actions: ISuccessActions)**
Инициализирует компонент Success, устанавливая ссылки на необходимые DOM-элементы и добавляя обработчик события клика на кнопку закрытия сообщения об успехе.

- **set total**
set total(amount: string)
Обновляет текстовое содержимое элемента totalElement, отображая сумму списанных средств пользователю.

## Класс Modal

Управляет модальными окнами в приложении.

### Методы:

- **open**
    ```typescript
    open(): void
    ```
    Открывает модальное окно и генерирует событие `modal:open`.

- **close**
    ```typescript
    close(): void
    ```
    Закрывает модальное окно, очищает содержимое и генерирует событие `modal:close`.

- **render**
    ```typescript
    render(data: IModalContent): HTMLElement
    ```
    Отображает переданный контент внутри модального окна и открывает его.





```markdown
## Основные события

### События от моделей:

- **`products:loaded`**
    - **Описание:** Генерируется после загрузки списка товаров.
    - **Параметры:** `IProductItem[]` — массив загруженных товаров.

- **`basket:updated`**
    - **Описание:** Генерируется при изменении содержимого корзины.
    - **Параметры:** `IProductItem[]` — обновленный список товаров в корзине.

- **`order:validated`**
    - **Описание:** Генерируется при успешной валидации данных заказа.
    - **Параметры:** `IOrder` — данные заказа.

- **`order:invalid`**
    - **Описание:** Генерируется при ошибке валидации данных заказа.
    - **Параметры:** `FormErrors` — объект с ошибками валидации.

- **`order:submitted`**
    - **Описание:** Генерируется после успешной отправки заказа на сервер.
    - **Параметры:** `IOrderResult` — результат заказа.

### События от представлений:

- **`product:selected`**
    - **Описание:** Генерируется при выборе товара.
    - **Параметры:** `IProductItem` — выбранный товар.

- **`product:addToBasket`**
    - **Описание:** Генерируется при добавлении товара в корзину.
    - **Параметры:** `IProductItem` — добавленный товар.

- **`basket:removeItem`**
    - **Описание:** Генерируется при удалении товара из корзины.
    - **Параметры:** `IProductItem` — удаленный товар.

- **`basket:checkout`**
    - **Описание:** Генерируется при переходе к оформлению заказа.
    - **Параметры:** `IOrderForm` — данные заказа.

- **`orderForm:submit`**
    - **Описание:** Генерируется при отправке формы заказа.
    - **Параметры:** `IOrderForm` — данные формы заказа.

- **`contactForm:submit`**
    - **Описание:** Генерируется при отправке формы контактных данных.
    - **Параметры:** `IOrderForm` — данные контактной формы.

- **`basket:open`**
    - **Описание:** Генерируется при открытии корзины.

- **`modal:opened`** и **`modal:closed`**
    - **Описание:** Генерируются при открытии и закрытии модального окна соответственно.